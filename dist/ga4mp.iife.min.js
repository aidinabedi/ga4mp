/*!
*
*   @aidinabedi/ga4mp 0.0.9
*   https://github.com/aidinabedi/ga4mp
*
*   Copyright (c) David Vallejo (https://www.thyngster.com).
*   This source code is licensed under the MIT license found in the
*   LICENSE file in the root directory of this source tree.
*
*/
var ga4mp=function(){"use strict";function e(e,n){(null==n||n>e.length)&&(n=e.length);for(var t=0,r=Array(n);t<n;t++)r[t]=e[t];return r}function n(){return n=Object.assign?Object.assign.bind():function(e){for(var n=1;n<arguments.length;n++){var t=arguments[n];for(var r in t)({}).hasOwnProperty.call(t,r)&&(e[r]=t[r])}return e},n.apply(null,arguments)}var t=function(e,n){return"string"==typeof e?e.substring(0,n):e},r=function(e){return"number"==typeof e&&!isNaN(e)},a=function(){return Math.floor(Date.now()/1e3)},o=function(e,n){try{e=e.toString()}catch(e){}return function(e){return null!=e&&"string"==typeof e}(e)&&n&&r(n)?t(e,n):e},i={_em:"em",event_name:"en",protocol_version:"v",_page_id:"_p",_is_debug:"_dbg",tracking_id:"tid",hit_count:"_s",user_id:"uid",client_id:"cid",page_location:"dl",language:"ul",firebase_id:"_fid",traffic_type:"tt",ignore_referrer:"ir",screen_resolution:"sr",global_developer_id_string:"gdid",redact_device_info:"_rdi",geo_granularity:"_geo",_is_passthrough_cid:"gtm_up",_is_linker_valid:"_glv",_user_agent_architecture:"uaa",_user_agent_bitness:"uab",_user_agent_full_version_list:"uafvl",_user_agent_mobile:"uamb",_user_agent_model:"uam",_user_agent_platform:"uap",_user_agent_platform_version:"uapv",_user_agent_wait:"uaW",_user_agent_wow64:"uaw",error_code:"ec",session_id:"sid",session_number:"sct",session_engaged:"seg",page_referrer:"dr",page_title:"dt",currency:"cu",campaign_content:"cc",campaign_id:"ci",campaign_medium:"cm",campaign_name:"cn",campaign_source:"cs",campaign_term:"ck",engagement_time_msec:"_et",event_developer_id_string:"edid",is_first_visit:"_fv",is_new_to_site:"_nsi",is_session_start:"_ss",is_conversion:"_c",euid_mode_enabled:"ecid",non_personalized_ads:"_npa",create_google_join:"gaz",is_consent_update:"gsu",user_ip_address:"_uip",google_consent_state:"gcs",google_consent_update:"gcu",us_privacy_string:"us_privacy",document_location:"dl",document_path:"dp",document_title:"dt",document_referrer:"dr",user_language:"ul",document_hostname:"dh",item_id:"id",item_name:"nm",item_brand:"br",item_category:"ca",item_category2:"c2",item_category3:"c3",item_category4:"c4",item_category5:"c5",item_variant:"va",price:"pr",quantity:"qt",coupon:"cp",item_list_name:"ln",index:"lp",item_list_id:"li",discount:"ds",affiliation:"af",promotion_id:"pi",promotion_name:"pn",creative_name:"cn",creative_slot:"cs",location_id:"lo",id:"id",name:"nm",brand:"br",variant:"va",list_name:"ln",list_position:"lp",list:"ln",position:"lp",creative:"cn"},s=["add_payment_info","add_shipping_info","add_to_cart","remove_from_cart","view_cart","begin_checkout","select_item","view_item_list","select_promotion","view_promotion","purchase","refund","view_item","add_to_wishlist"],u=function(n,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"browser",a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},o=JSON.parse(JSON.stringify(t)),i="";if(i=a.encode_search_params?Object.entries(o).map((function(n){var t,r,a=(r=2,function(e){if(Array.isArray(e))return e}(t=n)||function(e,n){var t=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=t){var r,a,o,i,s=[],u=!0,c=!1;try{if(o=(t=t.call(e)).next,0===n){if(Object(t)!==t)return;u=!1}else for(;!(u=(r=o.call(t)).done)&&(s.push(r.value),s.length!==n);u=!0);}catch(e){c=!0,a=e}finally{try{if(!u&&null!=t.return&&(i=t.return(),Object(i)!==i))return}finally{if(c)throw a}}return s}}(t,r)||function(n,t){if(n){if("string"==typeof n)return e(n,t);var r={}.toString.call(n).slice(8,-1);return"Object"===r&&n.constructor&&(r=n.constructor.name),"Map"===r||"Set"===r?Array.from(n):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?e(n,t):void 0}}(t,r)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()),o=a[0],i=a[1];return"".concat(o,"=").concat(encodeURIComponent(i))})).join("&"):new URLSearchParams(o).toString(),"browser"===r){var s;null===(s=navigator)||void 0===s||s.sendBeacon([n,i].join("?"))}else{var u=n.split("://")[0],c=require("".concat(u)),_={headers:{"User-Agent":a.user_agent},timeout:500},l=c.get([n,i].join("?"),_,(function(e){e.on("data",(function(e){})),e.on("end",(function(){}))})).on("error",(function(e){console.log("Error: "+e.message)}));l.on("timeout",(function(){l.destroy()}))}},c="0.0.8";return function(e){var _=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(!e)throw"Tracker initialization aborted: missing tracking ids";var l,d=n({version:c,debug:!1,mode:("undefined"!=typeof window&&void 0!==window.document?l="browser":"undefined"!=typeof process&&null!=process.versions&&null!=process.versions.node&&(l="node"),l||"browser"),measurement_ids:null,queueDispatchTime:5e3,queueDispatchMaxEvents:10,queue:[],eventParameters:{},persistentEventParameters:{},userProperties:{},user_agent:"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/107.0.0.0 Safari/537.36 [GA4MP/".concat(c,"]"),user_ip_address:null,hooks:{beforeLoad:function(){},beforeRequestSend:function(){}},endpoint:"https://www.google-analytics.com/g/collect",payloadData:{}},_);if(d.payloadData.protocol_version=2,d.payloadData.tracking_id=Array.isArray(e)?e:[e],d.payloadData.client_id=_.client_id?_.client_id:[Math.floor(2147483648*Math.random()+0),a()].join("."),d.payloadData._is_debug=_.debug?1:void 0,d.payloadData.non_personalized_ads=_.non_personalized_ads?1:void 0,d.payloadData.hit_count=1,d.payloadData.session_id=_.session_id?_.session_id:a(),d.payloadData.session_number=_.session_number?_.session_number:1,d.payloadData.user_id=_.user_id?t(_.user_id,256):void 0,d.payloadData.user_ip_address=_.user_ip_address?_.user_ip_address:void 0,d.userAgent="Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/107.0.0.0 Safari/537.36 [GA4MP/".concat(c,"]"),"node"===d&&_.user_agent&&(d.user_agent=_.user_agent),"browser"===d.mode){var p={page_location:document.location.href,page_referrer:document.referrer,page_title:document.title,language:(navigator&&(navigator.language||navigator.browserLanguage)||"").toLowerCase(),screen_resolution:(window.screen?window.screen.width:0)+"x"+(window.screen?window.screen.height:0)};p&&(d.payloadData=n(d.payloadData,p))}return{version:d.version,mode:d.mode,getHitIndex:function(){return d.payloadData.hit_count},getSessionId:function(){return d.payloadData.session_id},getClientId:function(){return d.payloadData.client_id},setUserProperty:function(e,n){e=o(e,24),n=o(n,36),d.userProperties[e]=n},setEventsParameter:function(e,n){if((t=n)&&("[object Function]"===Object.prototype.toString.call(t)||"function"==typeof t&&"[object RegExp]"!==Object.prototype.toString.call(t)))try{n=n()}catch(e){}var t;e=o(e,40),n=o(n,100),d.persistentEventParameters[e]=n},setUserId:function(e){d.payloadData.user_id=o(e,256)},trackEvent:function(e){var t,a,o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},c=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];(t=null==d?void 0:d.mode,"node"===t||"undefined"==typeof window||"undefined"!=typeof window&&!("navigator"in window)?new Promise((function(e){e(null)})):null!==(a=navigator)&&void 0!==a&&null!==(a=a.userAgentData)&&void 0!==a&&a.getHighEntropyValues?navigator.userAgentData.getHighEntropyValues(["platform","platformVersion","architecture","model","uaFullVersion","bitness","fullVersionList","wow64"]).then((function(e){var n,t,r;return{_user_agent_architecture:e.architecture,_user_agent_bitness:e.bitness,_user_agent_full_version_list:encodeURIComponent((e.fullVersionList&&Object.values(e.fullVersionList)||(null===(n=navigator)||void 0===n||null===(n=n.userAgentData)||void 0===n?void 0:n.brands)).map((function(e){return[e.brand,e.version].join(";")})).join("|")),_user_agent_mobile:e.mobile?1:0,_user_agent_model:e.model||(null===(t=navigator)||void 0===t||null===(t=t.userAgentData)||void 0===t?void 0:t.mobile),_user_agent_platform:e.platform||(null===(r=navigator)||void 0===r||null===(r=r.userAgentData)||void 0===r?void 0:r.platform),_user_agent_platform_version:e.platformVersion,_user_agent_wow64:e.wow64?1:0}})):new Promise((function(e){e(null)}))).then((function(t){t&&(d.payloadData=n(d.payloadData,t));var a=function(e,t){var a={};1===d.payloadData.hit_count&&(d.payloadData.session_engaged=1),Object.entries(d.payloadData).forEach((function(e){var n=e[0],t=e[1];i[n]&&(a[i[n]]="boolean"==typeof t?+t:t)}));var o=n(JSON.parse(JSON.stringify(d.persistentEventParameters)),JSON.parse(JSON.stringify(t)));return o.event_name=e,Object.entries(o).forEach((function(n){var t=n[0],o=n[1];if("items"===t&&s.indexOf(e)>-1&&Array.isArray(o))for(var u=o.slice(0,200),c=function(){if(u[_]){var e={core:{},custom:{}};Object.entries(u[_]).forEach((function(n){i[n[0]]?void 0!==n[1]&&(e.core[i[n[0]]]=n[1]):e.custom[n[0]]=n[1]}));var n=Object.entries(e.core).map((function(e){return e[0]+e[1]})).join("~")+"~"+Object.entries(e.custom).map((function(e,n){var t=10>n?""+n:String.fromCharCode(65+n-10);return"k".concat(t).concat(e[0],"~v").concat(t).concat(e[1])})).join("~");a["pr".concat(_+1)]=n}},_=0;_<u.length;_++)c();else i[t]?a[i[t]]="boolean"==typeof o?+o:o:a[(r(o)?"epn.":"ep.")+t]=o})),Object.entries(d.userProperties).forEach((function(e){var n=e[0],t=e[1];i[n]?a[i[n]]="boolean"==typeof t?+t:t:a[(r(t)?"upn.":"up.")+n]=t})),a}(e,o);if(a&&c){for(var _=0;_<a.tid.length;_++){var l=JSON.parse(JSON.stringify(a));l.tid=a.tid[_],u(d.endpoint,l,d.mode,{user_agent:null==d?void 0:d.user_agent})}d.payloadData.hit_count++}else d.queue.push(event)>=d.queueDispatchMaxEvents&&(d.queue=[])}))}}}}();
